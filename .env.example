# ==============================================================================
# Chat and Notifications Service - Environment Variables
# ==============================================================================
# Copy this file to .env and configure for your environment
#
# Services:
#   - chatpersistence: Chat message persistence API
#   - chatpersistencechangehandler: CDC consumer for chat synchronization
#   - chatwebsocketshandler: Chat websocket management service
#   - generalnotificationshandler: General notification websocket service
#   - emailhandler: Email notification service
# ==============================================================================

# ==============================================================================
# HTTP Server Configuration
# ==============================================================================
# Used by: chatpersistence, chatwebsocketshandler, generalnotificationshandler, emailhandler

# Server listen address (e.g., :8080, 0.0.0.0:8080)
LISTEN_ADDR=:8080

# HTTP read timeout
READ_TIMEOUT=30s

# HTTP write timeout
WRITE_TIMEOUT=30s

# Graceful shutdown timeout
SHUTDOWN_TIMEOUT=30s

# ==============================================================================
# WebSocket Configuration
# ==============================================================================
# Used by: chatwebsocketshandler, generalnotificationshandler

# Interval for sending ping messages to clients
PING_INTERVAL=30s

# Maximum time to wait for pong response from client
PONG_WAIT=40s

# Maximum time to wait when writing messages to client
WRITE_WAIT=10s

# ==============================================================================
# MongoDB Configuration
# ==============================================================================
# Used by: chatpersistence, chatwebsocketshandler, generalnotificationshandler, emailhandler

# MongoDB connection URI (e.g., mongodb://username:password@host:port)
MONGO_URI=mongodb://localhost:27017

# MongoDB database name
MONGO_DATABASE=notifications

# ==============================================================================
# Redis Configuration
# ==============================================================================
# Used by: chatpersistencechangehandler (for event deduplication)

# Redis server address (host:port)
REDIS_ADDR=localhost:6379

# Redis password (leave empty if no password)
REDIS_PASSWORD=

# Redis database number
REDIS_DB=0

# Redis connection pool size
REDIS_POOL_SIZE=10

# ==============================================================================
# Event Store Configuration (Redis-based deduplication)
# ==============================================================================
# Used by: chatpersistencechangehandler

# Time-to-live for deduplication keys (e.g., 5m, 1h, 24h)
DEDUPLICATION_TTL=5m

# Prefix for event store keys in Redis
EVENT_STORE_KEY_PREFIX=event-store

# ==============================================================================
# Kafka Consumer Configuration - Chat Persistence Change Handler
# ==============================================================================
# Used by: chatpersistencechangehandler

# Kafka topic name for CDC events
CHAT_PERSISTENCE_CHANGE_KAFKA_CONSUMER_INFO_TOPIC_NAME=chat-persistence-change

# Kafka consumer group name
CHAT_PERSISTENCE_CHANGE_KAFKA_CONSUMER_INFO_CONSUMER_NAME=chat-persistence-change-consumer

# Whether to ignore messages published before consumer starts
CHAT_PERSISTENCE_CHANGE_KAFKA_CONSUMER_INFO_IGNORE_OLD_MESSAGE=false

# Kafka broker addresses (comma-separated)
CHAT_PERSISTENCE_CHANGE_KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# Enable SASL authentication
CHAT_PERSISTENCE_CHANGE_KAFKA_SASL_ENABLED=false

# SASL mechanism (e.g., PLAIN, SCRAM-SHA-256, SCRAM-SHA-512)
CHAT_PERSISTENCE_CHANGE_KAFKA_SASL_MECHANISMS=SCRAM-SHA-512

# SASL username (required if SASL is enabled)
CHAT_PERSISTENCE_CHANGE_KAFKA_SASL_USERNAME=

# SASL password (required if SASL is enabled)
CHAT_PERSISTENCE_CHANGE_KAFKA_SASL_PASSWORD=

# Enable TLS/SSL
CHAT_PERSISTENCE_CHANGE_KAFKA_TLS_ENABLED=false

# Kafka version (optional, auto-detected if not set)
CHAT_PERSISTENCE_CHANGE_KAFKA_VERSION=

# Consumer session timeout
CHAT_PERSISTENCE_CHANGE_KAFKA_SESSION_TIMEOUT=

# Consumer heartbeat interval
CHAT_PERSISTENCE_CHANGE_KAFKA_HEARTBEAT_INTERVAL=

# ==============================================================================
# Kafka Retry Configuration - Message Processing
# ==============================================================================
# Used by: chatpersistencechangehandler

# Maximum number of retry attempts for failed messages
MESSAGE_RETRY_MAX_RETRIES=3

# Initial delay before first retry
MESSAGE_RETRY_INITIAL_INTERVAL=1s

# Maximum delay between retries
MESSAGE_RETRY_MAX_INTERVAL=30s

# Backoff multiplier for retry delays
MESSAGE_RETRY_MULTIPLIER=2

# ==============================================================================
# Outgoing HTTP Configuration - General Notification Service
# ==============================================================================
# Used by: chatpersistencechangehandler (to forward notifications)

# General notification service endpoint
GENERAL_NOTIFICATION_OUTGOING_CONFIG_CLIENT_HOST=http://generalnotificationshandler:8080

# Request timeout for general notification service
GENERAL_NOTIFICATION_OUTGOING_CONFIG_CLIENT_TIMEOUT=2s

# ==============================================================================
# Outgoing HTTP Configuration - Chat Message Socket Transfer
# ==============================================================================
# Used by: chatpersistencechangehandler (to forward chat messages to websockets)

# Chat websocket handler endpoint
CHAT_MESSAGE_SOCKET_TRANSFER_OUTGOING_CONFIG_CLIENT_HOST=http://chatwebsocketshandler:8080

# Request timeout for chat websocket handler
CHAT_MESSAGE_SOCKET_TRANSFER_OUTGOING_CONFIG_CLIENT_TIMEOUT=2s

# ==============================================================================
# SMTP Email Configuration
# ==============================================================================
# Used by: emailhandler

# SMTP server hostname
SMTP_HOST=smtp.example.com

# SMTP server port (typically 587 for TLS, 465 for SSL, 25 for plain)
SMTP_PORT=587

# SMTP authentication username
SMTP_USERNAME=your-email@example.com

# SMTP authentication password
SMTP_PASSWORD=your-smtp-password

# Email address to use in "From" field
EMAIL_FROM_ADDRESS=noreply@example.com

# Name to use in "From" field (optional)
EMAIL_FROM_NAME=Notifications Service

# ==============================================================================
# OpenTelemetry / Observability Configuration (doakes library)
# ==============================================================================
# Used by: All services (via doakes library)

# Service name for telemetry (auto-detected from binary name if not set)
OTEL_SERVICE_NAME=

# Service version for telemetry
OTEL_SERVICE_VERSION=

# Service namespace for telemetry
OTEL_SERVICE_NAMESPACE=

# Telemetry server listen address (for Prometheus metrics and health checks)
# If not set, uses a random available port
TELEMETRY_SERVER_ADDR=

# Enable runtime metrics collection
TELEMETRY_ENABLE_RUNTIME_METRICS=true

# Metrics export interval
TELEMETRY_METRICS_EXPORT_INTERVAL=30s

# ==============================================================================
# Development / Debug Configuration
# ==============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=info

# Enable debug mode
DEBUG=false

# Enable profiling endpoints (pprof)
ENABLE_PROFILING=false

# ==============================================================================
# Notes
# ==============================================================================
#
# Service-specific environment variables:
#
# 1. chatpersistence:
#    - LISTEN_ADDR, READ_TIMEOUT, WRITE_TIMEOUT, SHUTDOWN_TIMEOUT
#    - MONGO_URI, MONGO_DATABASE
#
# 2. chatpersistencechangehandler:
#    - CHAT_PERSISTENCE_CHANGE_KAFKA_* (all Kafka config)
#    - MESSAGE_RETRY_* (retry config)
#    - REDIS_ADDR, REDIS_PASSWORD, REDIS_DB, REDIS_POOL_SIZE
#    - DEDUPLICATION_TTL, EVENT_STORE_KEY_PREFIX
#    - GENERAL_NOTIFICATION_OUTGOING_CONFIG_*
#    - CHAT_MESSAGE_SOCKET_TRANSFER_OUTGOING_CONFIG_*
#
# 3. chatwebsocketshandler:
#    - LISTEN_ADDR, READ_TIMEOUT, WRITE_TIMEOUT, SHUTDOWN_TIMEOUT
#    - PING_INTERVAL, PONG_WAIT, WRITE_WAIT
#    - MONGO_URI, MONGO_DATABASE
#
# 4. generalnotificationshandler:
#    - LISTEN_ADDR, READ_TIMEOUT, WRITE_TIMEOUT, SHUTDOWN_TIMEOUT
#    - PING_INTERVAL, PONG_WAIT, WRITE_WAIT
#
# 5. emailhandler:
#    - SMTP_HOST, SMTP_PORT, SMTP_USERNAME, SMTP_PASSWORD
#    - EMAIL_FROM_ADDRESS, EMAIL_FROM_NAME
#    - MONGO_URI, MONGO_DATABASE
#
# All services use OpenTelemetry/observability configuration (OTEL_*, TELEMETRY_*)
# for metrics, tracing, and health checks via the doakes library.
#
# ==============================================================================

